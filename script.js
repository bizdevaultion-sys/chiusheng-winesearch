const wineCatalog = {
  "拉菲": {
    1982: { score: 95, stock: 1 },
    1983: { score: 91, stock: 0 },
    1984: { score: 87, stock: 0 },
    1985: { score: 92, stock: 0 },
    1986: { score: 96, stock: 0 },
    1987: { score: 87, stock: 0 },
    1988: { score: 94, stock: 0 },
    1989: { score: 93, stock: 1 },
    1990: { score: 95, stock: 0 },
    1991: { score: 88, stock: 0 },
    1992: { score: 89, stock: 0 },
    1993: { score: 88, stock: 0 },
    1994: { score: 90, stock: 0 },
    1995: { score: 95, stock: 2 },
    1996: { score: 97, stock: 0 },
    1997: { score: 92, stock: 0 },
    1998: { score: 94, stock: 0 },
    1999: { score: 93, stock: 5 },
    2000: { score: 97, stock: 0 },
    2001: { score: 95, stock: 0 },
    2002: { score: 93, stock: 2 },
    2003: { score: 96, stock: 0 },
    2004: { score: 94, stock: 0 },
    2005: { score: 96, stock: 6 },
    2006: { score: 94, stock: 2 },
    2007: { score: 93, stock: 0 },
    2008: { score: 94, stock: 1 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 6 },
    2011: { score: 93, stock: 0 },
    2012: { score: 93, stock: 0 },
    2013: { score: 91, stock: 0 },
    2014: { score: 94, stock: 0 },
    2015: { score: 95, stock: 0 },
    2016: { score: 98, stock: 0 },
    2017: { score: 95, stock: 4 },
    2018: { score: 98, stock: 0 },
    2019: { score: 97, stock: 0 },
    2020: { score: 97, stock: 0 },
    2021: { score: 96, stock: 0 },
    2022: { score: 98, stock: 4 },
    2023: { score: 97, stock: 0 },
    2024: { score: 95, stock: 0 }
  },
  "拉圖": {
    1982: { score: 98, stock: 0 },
    1983: { score: 90, stock: 0 },
    1984: { score: 87, stock: 0 },
    1985: { score: 92, stock: 0 },
    1986: { score: 90, stock: 0 },
    1987: { score: 88, stock: 0 },
    1988: { score: 92, stock: 0 },
    1989: { score: 92, stock: 1 },
    1990: { score: 97, stock: 0 },
    1991: { score: 91, stock: 0 },
    1992: { score: 90, stock: 0 },
    1993: { score: 90, stock: 0 },
    1994: { score: 92, stock: 0 },
    1995: { score: 94, stock: 0 },
    1996: { score: 96, stock: 0 },
    1997: { score: 90, stock: 0 },
    1998: { score: 92, stock: 0 },
    1999: { score: 92, stock: 0 },
    2000: { score: 96, stock: 0 },
    2001: { score: 94, stock: 1 },
    2002: { score: 94, stock: 0 },
    2003: { score: 97, stock: 0 },
    2004: { score: 94, stock: 0 },
    2005: { score: 97, stock: 0 },
    2006: { score: 95, stock: 0 },
    2007: { score: 93, stock: 0 },
    2008: { score: 94, stock: 0 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 0 },
    2011: { score: 94, stock: 3 },
    2012: { score: 94, stock: 0 },
    2013: { score: 92, stock: 6 },
    2014: { score: 95, stock: 0 },
    2015: { score: 96, stock: 0 },
    2016: { score: 98, stock: 0 },
    2017: { score: 96, stock: 0 }
  },
  "奧比安": {
    1982: { score: 95, stock: 0 },
    1983: { score: 91, stock: 0 },
    1984: { score: 87, stock: 0 },
    1985: { score: 94, stock: 0 },
    1986: { score: 93, stock: 0 },
    1987: { score: 87, stock: 0 },
    1988: { score: 93, stock: 0 },
    1989: { score: 99, stock: 5 },
    1990: { score: 96, stock: 0 },
    1991: { score: 89, stock: 0 },
    1992: { score: 89, stock: 0 },
    1993: { score: 91, stock: 0 },
    1994: { score: 92, stock: 1 },
    1995: { score: 94, stock: 0 },
    1996: { score: 93, stock: 0 },
    1998: { score: 96, stock: 0 },
    1999: { score: 93, stock: 0 },
    2000: { score: 96, stock: 0 },
    2001: { score: 94, stock: 0 },
    2002: { score: 92, stock: 0 },
    2003: { score: 94, stock: 0 },
    2004: { score: 94, stock: 0 },
    2005: { score: 97, stock: 0 },
    2006: { score: 95, stock: 1 },
    2007: { score: 94, stock: 0 },
    2008: { score: 94, stock: 0 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 0 },
    2011: { score: 94, stock: 0 },
    2012: { score: 95, stock: 0 },
    2013: { score: 93, stock: 0 },
    2014: { score: 95, stock: 0 },
    2015: { score: 97, stock: 0 },
    2016: { score: 97, stock: 0 },
    2017: { score: 96, stock: 0 },
    2018: { score: 97, stock: 0 },
    2019: { score: 97, stock: 0 },
    2020: { score: 97, stock: 0 },
    2021: { score: 96, stock: 0 },
    2022: { score: 97, stock: 0 },
    2023: { score: 96, stock: 0 },
    2024: { score: 95, stock: 0 }
  },
  "木桶": {
    1982: { score: 97, stock: 0 },
    1983: { score: 92, stock: 0 },
    1984: { score: 87, stock: 0 },
    1985: { score: 92, stock: 0 },
    1986: { score: 96, stock: 0 },
    1987: { score: 89, stock: 0 },
    1988: { score: 91, stock: 0 },
    1989: { score: 93, stock: 0 },
    1990: { score: 91, stock: 0 },
    1991: { score: 88, stock: 0 },
    1992: { score: 86, stock: 0 },
    1993: { score: 89, stock: 0 },
    1994: { score: 90, stock: 0 },
    1995: { score: 93, stock: 0 },
    1996: { score: 94, stock: 6 },
    1997: { score: 90, stock: 0 },
    1998: { score: 94, stock: 0 },
    1999: { score: 91, stock: 2 },
    2000: { score: 95, stock: 0 },
    2001: { score: 92, stock: 5 },
    2002: { score: 93, stock: 6 },
    2003: { score: 94, stock: 5 },
    2004: { score: 93, stock: 0 },
    2005: { score: 96, stock: 0 },
    2006: { score: 95, stock: 0 },
    2007: { score: 93, stock: 0 },
    2008: { score: 95, stock: 0 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 0 },
    2011: { score: 94, stock: 0 },
    2012: { score: 95, stock: 0 },
    2013: { score: 92, stock: 0 },
    2014: { score: 96, stock: 0 },
    2015: { score: 96, stock: 0 },
    2016: { score: 98, stock: 0 },
    2017: { score: 95, stock: 0 },
    2018: { score: 98, stock: 0 },
    2019: { score: 98, stock: 4 },
    2020: { score: 98, stock: 0 },
    2021: { score: 95, stock: 0 },
    2022: { score: 98, stock: 0 },
    2023: { score: 97, stock: 0 },
    2024: { score: 94, stock: 0 }
  },
  "瑪歌": {
    1982: { score: 96, stock: 0 },
    1983: { score: 96, stock: 0 },
    1984: { score: 87, stock: 0 },
    1985: { score: 95, stock: 0 },
    1986: { score: 93, stock: 0 },
    1987: { score: 88, stock: 0 },
    1988: { score: 92, stock: 0 },
    1989: { score: 94, stock: 0 },
    1990: { score: 97, stock: 0 },
    1991: { score: 90, stock: 0 },
    1992: { score: 87, stock: 1 },
    1993: { score: 91, stock: 0 },
    1994: { score: 91, stock: 0 },
    1995: { score: 94, stock: 0 },
    1996: { score: 97, stock: 0 },
    1997: { score: 91, stock: 0 },
    1998: { score: 94, stock: 0 },
    1999: { score: 93, stock: 0 },
    2000: { score: 98, stock: 0 },
    2001: { score: 94, stock: 0 },
    2002: { score: 93, stock: 0 },
    2003: { score: 96, stock: 0 },
    2004: { score: 94, stock: 0 },
    2005: { score: 97, stock: 0 },
    2006: { score: 94, stock: 0 },
    2007: { score: 93, stock: 0 },
    2008: { score: 94, stock: 0 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 0 },
    2011: { score: 94, stock: 0 },
    2012: { score: 94, stock: 0 },
    2013: { score: 92, stock: 0 },
    2014: { score: 95, stock: 4 },
    2015: { score: 98, stock: 0 },
    2016: { score: 98, stock: 4 },
    2017: { score: 96, stock: 0 },
    2018: { score: 97, stock: 0 },
    2019: { score: 97, stock: 0 },
    2020: { score: 97, stock: 0 },
    2021: { score: 96, stock: 0 },
    2022: { score: 97, stock: 0 },
    2023: { score: 97, stock: 0 },
    2024: { score: 95, stock: 0 }
  },
  "雄獅": {
    1982: { score: 95, stock: 0 },
    1983: { score: 90, stock: 0 },
    1984: { score: 89, stock: 0 },
    1985: { score: 95, stock: 0 },
    1986: { score: 96, stock: 0 },
    1987: { score: 88, stock: 0 },
    1988: { score: 93, stock: 0 },
    1989: { score: 91, stock: 0 },
    1990: { score: 95, stock: 0 },
    1991: { score: 91, stock: 0 },
    1992: { score: 90, stock: 0 },
    1993: { score: 91, stock: 0 },
    1994: { score: 92, stock: 0 },
    1995: { score: 94, stock: 0 },
    1996: { score: 96, stock: 0 },
    1997: { score: 91, stock: 0 },
    1998: { score: 93, stock: 0 },
    1999: { score: 91, stock: 0 },
    2000: { score: 96, stock: 15 },
    2001: { score: 94, stock: 0 },
    2002: { score: 93, stock: 0 },
    2003: { score: 94, stock: 0 },
    2004: { score: 93, stock: 0 },
    2005: { score: 96, stock: 6 },
    2006: { score: 94, stock: 0 },
    2007: { score: 92, stock: 0 },
    2008: { score: 94, stock: 24 },
    2009: { score: 96, stock: 2 },
    2010: { score: 95, stock: 0 },
    2011: { score: 93, stock: 0 },
    2012: { score: 94, stock: 0 },
    2013: { score: 92, stock: 0 },
    2014: { score: 95, stock: 0 },
    2015: { score: 96, stock: 0 },
    2016: { score: 98, stock: 0 },
    2017: { score: 95, stock: 0 },
    2018: { score: 97, stock: 0 },
    2019: { score: 97, stock: 0 },
    2020: { score: 97, stock: 0 },
    2021: { score: 94, stock: 12 },
    2022: { score: 98, stock: 0 },
    2023: { score: 96, stock: 0 },
    2024: { score: 95, stock: 0 }
  },
  "白馬": {
    1982: { score: 96, stock: 0 },
    1983: { score: 93, stock: 0 },
    1984: { score: 83, stock: 0 },
    1985: { score: 95, stock: 0 },
    1986: { score: 92, stock: 0 },
    1987: { score: 88, stock: 0 },
    1988: { score: 91, stock: 0 },
    1989: { score: 94, stock: 0 },
    1990: { score: 97, stock: 1 },
    1992: { score: 83, stock: 0 },
    1993: { score: 90, stock: 1 },
    1994: { score: 89, stock: 1 },
    1995: { score: 94, stock: 1 },
    1996: { score: 91, stock: 2 },
    1997: { score: 89, stock: 1 },
    1998: { score: 96, stock: 0 },
    1999: { score: 92, stock: 4 },
    2000: { score: 96, stock: 0 },
    2001: { score: 94, stock: 0 },
    2002: { score: 91, stock: 0 },
    2003: { score: 93, stock: 1 },
    2004: { score: 93, stock: 0 },
    2005: { score: 97, stock: 0 },
    2006: { score: 94, stock: 0 },
    2007: { score: 92, stock: 0 },
    2008: { score: 94, stock: 0 },
    2009: { score: 97, stock: 0 },
    2010: { score: 97, stock: 0 },
    2011: { score: 94, stock: 0 },
    2012: { score: 94, stock: 0 },
    2013: { score: 92, stock: 0 },
    2014: { score: 95, stock: 0 },
    2015: { score: 97, stock: 0 },
    2016: { score: 97, stock: 0 },
    2017: { score: 95, stock: 0 },
    2018: { score: 97, stock: 0 },
    2019: { score: 98, stock: 0 },
    2020: { score: 97, stock: 0 },
    2021: { score: 95, stock: 0 },
    2022: { score: 98, stock: 0 },
    2023: { score: 97, stock: 0 },
    2024: { score: 95, stock: 0 }
  },
  "波菲": {
    1982: { score: 93, stock: 0 },
    1983: { score: 89, stock: 0 },
    1984: { score: 83, stock: 0 },
    1985: { score: 90, stock: 0 },
    1986: { score: 91, stock: 0 },
    1987: { score: 86, stock: 0 },
    1988: { score: 87, stock: 0 },
    1989: { score: 90, stock: 0 },
    1990: { score: 95, stock: 0 },
    1991: { score: 84, stock: 0 },
    1992: { score: 83, stock: 0 },
    1993: { score: 86, stock: 0 },
    1994: { score: 88, stock: 0 },
    1995: { score: 91, stock: 0 },
    1996: { score: 91, stock: 0 },
    1997: { score: 88, stock: 0 },
    1998: { score: 90, stock: 0 },
    1999: { score: 90, stock: 0 },
    2000: { score: 93, stock: 2 },
    2001: { score: 91, stock: 0 },
    2002: { score: 90, stock: 0 },
    2003: { score: 93, stock: 0 },
    2004: { score: 92, stock: 0 },
    2005: { score: 94, stock: 0 },
    2006: { score: 92, stock: 0 },
    2007: { score: 91, stock: 0 },
    2008: { score: 92, stock: 2 },
    2009: { score: 95, stock: 0 },
    2010: { score: 95, stock: 0 },
    2011: { score: 92, stock: 0 },
    2012: { score: 92, stock: 0 },
    2013: { score: 91, stock: 6 },
    2014: { score: 93, stock: 0 },
    2015: { score: 94, stock: 0 },
    2016: { score: 96, stock: 0 },
    2017: { score: 93, stock: 0 },
    2018: { score: 95, stock: 0 },
    2019: { score: 95, stock: 0 },
    2020: { score: 95, stock: 0 },
    2021: { score: 93, stock: 0 },
    2022: { score: 95, stock: 0 },
    2023: { score: 95, stock: 0 },
    2024: { score: 93, stock: 0 }
  }
};
function init() {
  const brandTrigger = document.querySelector("#brandTrigger");
  const yearTrigger = document.querySelector("#yearTrigger");
  const brandDialog = document.querySelector("#brandDialog");
  const yearDialog = document.querySelector("#yearDialog");
  const brandList = document.querySelector("#brandList");
  const yearList = document.querySelector("#yearList");
  const result = document.querySelector("#result");

  let selectedBrand = null;
  let selectedYear = null;

  const closeButtons = Array.from(document.querySelectorAll("dialog .close"));
  closeButtons.forEach((btn) => {
    btn.addEventListener("click", () => btn.closest("dialog").close());
  });

  function renderOptions(container, items, onPick) {
    container.textContent = "";
    items.forEach((value) => {
      const optionBtn = document.createElement("button");
      optionBtn.type = "button";
      optionBtn.textContent = value;
      optionBtn.addEventListener("click", () => onPick(value));
      container.append(optionBtn);
    });
  }

  function renderResult() {
    if (!selectedBrand || !selectedYear) {
      result.innerHTML = "<p>等待選擇...</p>";
      return;
    }

    const { score, stock } = wineCatalog[selectedBrand][selectedYear];
    result.innerHTML = `
      <strong>${selectedBrand} · ${selectedYear}</strong>
      <p>分數: <span>${score}</span></p>
      <p>庫存: <span>${stock}</span></p>
    `;
  }

  brandTrigger.addEventListener("click", () => {
    renderOptions(brandList, Object.keys(wineCatalog), (brand) => {
      selectedBrand = brand;
      selectedYear = null;
      brandTrigger.textContent = brand;
      yearTrigger.textContent = "選擇年份";
      yearTrigger.disabled = false;
      brandDialog.close();
      renderResult();
    });

    brandDialog.showModal();
  });

  yearTrigger.addEventListener("click", () => {
    if (yearTrigger.disabled || !selectedBrand) return;

    const years = Object.keys(wineCatalog[selectedBrand]).map(Number).sort((a, b) => b - a).map(String);
    
    yearList.textContent = "";
    years.forEach((year) => {
      const optionBtn = document.createElement("button");
      optionBtn.type = "button";
      optionBtn.textContent = year;
      
      // Check if this year has stock and add highlight class
      const yearData = wineCatalog[selectedBrand][year];
      if (yearData && yearData.stock > 0) {
        optionBtn.classList.add("in-stock");
      }
      
      optionBtn.addEventListener("click", () => {
        selectedYear = year;
        yearTrigger.textContent = year;
        yearDialog.close();
        renderResult();
      });
      yearList.append(optionBtn);
    });

    yearDialog.showModal();
  });
}

// Wait for DOM to be ready
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", init);
} else {
  init();
}
